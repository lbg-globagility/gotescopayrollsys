/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!50503 SET NAMES utf8mb4 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

DROP VIEW IF EXISTS `employee_activeperiod`;
DROP TABLE IF EXISTS `employee_activeperiod`;
CREATE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `employee_activeperiod` AS select `e`.`RowID` AS `RowId`,`pp`.`RowID` AS `PayPeriodId`,if(`_start`.`RowID` = `pp`.`RowID`,'Initial period','Succeeding period of initial year') AS `Description` from ((`employee` `e` join `payperiod` `_start` on(`_start`.`OrganizationID` = `e`.`OrganizationID` and `_start`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `e`.`StartDate` between `_start`.`PayFromDate` and `_start`.`PayToDate`)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `pp`.`Year` = `_start`.`Year` and `pp`.`OrdinalValue` >= `_start`.`OrdinalValue`)) where find_in_set(`e`.`EmploymentStatus`,`UNEMPLOYEMENT_STATUSES`()) = 0 union select `e`.`RowID` AS `RowId`,`pp`.`RowID` AS `PayPeriodId`,'Served period(s)' AS `Description` from ((`employee` `e` join `payperiod` `_start` on(`_start`.`OrganizationID` = `e`.`OrganizationID` and `_start`.`TotalGrossSalary` = `e`.`PayFrequencyID` and date_format(`e`.`StartDate`,'2010-%m-%d') between `_start`.`PayFromDate` and `_start`.`PayToDate`)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `pp`.`Year` >= `_start`.`Year` + 1)) where find_in_set(`e`.`EmploymentStatus`,`UNEMPLOYEMENT_STATUSES`()) = 0 and year(`e`.`StartDate`) < 2010 union select `e`.`RowID` AS `RowId`,`pp`.`RowID` AS `PayPeriodId`,'Served period(s)' AS `Description` from ((`employee` `e` join `payperiod` `_start` on(`_start`.`OrganizationID` = `e`.`OrganizationID` and `_start`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `e`.`StartDate` between `_start`.`PayFromDate` and `_start`.`PayToDate`)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `pp`.`Year` >= `_start`.`Year` + 1)) where find_in_set(`e`.`EmploymentStatus`,`UNEMPLOYEMENT_STATUSES`()) = 0 union select `e`.`EmployeeId` AS `RowId`,`pp`.`RowID` AS `PayPeriodId`,if(`_start`.`RowID` = `pp`.`RowID`,'Initial period','Succeeding period of initial year') AS `Description` from (((`employee_quitperiod` `e` join `employee` `ee` on(`ee`.`RowID` = `e`.`EmployeeId`)) join `payperiod` `_start` on(`_start`.`OrganizationID` = `e`.`OrganizationID` and `_start`.`TotalGrossSalary` = `ee`.`PayFrequencyID` and `ee`.`StartDate` between `_start`.`PayFromDate` and `_start`.`PayToDate`)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `pp`.`Year` = `_start`.`Year` and `pp`.`OrdinalValue` >= `_start`.`OrdinalValue`)) union select `e`.`EmployeeId` AS `RowId`,`pp`.`RowID` AS `PayPeriodId`,'Served period(s)' AS `Description` from ((((`employee_quitperiod` `e` join `employee` `ee` on(`ee`.`RowID` = `e`.`EmployeeId`)) join `payperiod` `quit` on(`quit`.`RowID` = `e`.`PayPeriodId`)) join `payperiod` `_start` on(`_start`.`OrganizationID` = `e`.`OrganizationID` and `_start`.`TotalGrossSalary` = `ee`.`PayFrequencyID` and `ee`.`StartDate` between `_start`.`PayFromDate` and `_start`.`PayToDate`)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `pp`.`Year` between `_start`.`Year` + 1 and `quit`.`Year` - 1)) union select `e`.`EmployeeId` AS `RowId`,`pp`.`RowID` AS `PayPeriodId`,'Year of quit, and rest served period' AS `Description` from ((`employee_quitperiod` `e` join `payperiod` `quit` on(`quit`.`RowID` = `e`.`PayPeriodId`)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `pp`.`Year` = `quit`.`Year` and `pp`.`OrdinalValue` <= `quit`.`OrdinalValue`)) ;

/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IF(@OLD_FOREIGN_KEY_CHECKS IS NULL, 1, @OLD_FOREIGN_KEY_CHECKS) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
