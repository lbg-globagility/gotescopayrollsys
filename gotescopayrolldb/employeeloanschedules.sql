/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!50503 SET NAMES utf8mb4 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

DROP VIEW IF EXISTS `employeeloanschedules`;
DROP TABLE IF EXISTS `employeeloanschedules`;
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `employeeloanschedules` AS select `els`.`RowID` AS `RowID`,`els`.`OrganizationID` AS `OrganizationID`,`els`.`Created` AS `Created`,`els`.`CreatedBy` AS `CreatedBy`,`els`.`LastUpd` AS `LastUpd`,`els`.`LastUpdBy` AS `LastUpdBy`,`els`.`EmployeeID` AS `EmployeeID`,`els`.`LoanNumber` AS `LoanNumber`,`els`.`DedEffectiveDateFrom` AS `DedEffectiveDateFrom`,`els`.`DedEffectiveDateTo` AS `DedEffectiveDateTo`,`els`.`TotalLoanAmount` AS `TotalLoanAmount`,`els`.`DeductionSchedule` AS `DeductionSchedule`,`els`.`TotalBalanceLeft` AS `TotalBalanceLeft`,`els`.`DeductionAmount` AS `DeductionAmount`,`els`.`Status` AS `Status`,`els`.`LoanTypeID` AS `LoanTypeID`,`els`.`DeductionPercentage` AS `DeductionPercentage`,`els`.`NoOfPayPeriod` AS `NoOfPayPeriod`,`els`.`LoanPayPeriodLeft` AS `LoanPayPeriodLeft`,`els`.`Comments` AS `Comments`,`els`.`Nondeductible` AS `Nondeductible`,`els`.`ReferenceLoanID` AS `ReferenceLoanID`,`els`.`SubstituteEndDate` AS `SubstituteEndDate`,`els`.`PayStubID` AS `PayStubID`,`pp`.`RowID` AS `PayPeriodID`,`pp`.`Year` AS `Year`,`pp`.`Month` AS `Month`,`pp`.`OrdinalValue` AS `OrdinalValue`,`pp`.`PayFromDate` AS `PayFromDate`,`pp`.`PayToDate` AS `PayToDate`,`ps`.`RowID` AS `PayStubRowId` from (((((`employeeloanschedule` `els` join `employee` `e` on(`e`.`RowID` = `els`.`EmployeeID` and find_in_set(`e`.`EmploymentStatus`,`UNEMPLOYEMENT_STATUSES`()) = 0)) join `dates` `d` on(`d`.`DateValue` between `els`.`DedEffectiveDateFrom` and `els`.`DedEffectiveDateTo`)) join `organization` `og` on(`og`.`RowID` = `els`.`OrganizationID` and `og`.`NoPurpose` = 0)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `d`.`DateValue` between `pp`.`PayFromDate` and `pp`.`PayToDate` and `pp`.`Half` = 0)) left join `paystub` `ps` on(`ps`.`EmployeeID` = `e`.`RowID` and `ps`.`OrganizationID` = `e`.`OrganizationID` and `ps`.`PayPeriodID` = `pp`.`RowID`)) where `els`.`DeductionSchedule` = 'End of the month' union select `els`.`RowID` AS `RowID`,`els`.`OrganizationID` AS `OrganizationID`,`els`.`Created` AS `Created`,`els`.`CreatedBy` AS `CreatedBy`,`els`.`LastUpd` AS `LastUpd`,`els`.`LastUpdBy` AS `LastUpdBy`,`els`.`EmployeeID` AS `EmployeeID`,`els`.`LoanNumber` AS `LoanNumber`,`els`.`DedEffectiveDateFrom` AS `DedEffectiveDateFrom`,`els`.`DedEffectiveDateTo` AS `DedEffectiveDateTo`,`els`.`TotalLoanAmount` AS `TotalLoanAmount`,`els`.`DeductionSchedule` AS `DeductionSchedule`,`els`.`TotalBalanceLeft` AS `TotalBalanceLeft`,`els`.`DeductionAmount` AS `DeductionAmount`,`els`.`Status` AS `Status`,`els`.`LoanTypeID` AS `LoanTypeID`,`els`.`DeductionPercentage` AS `DeductionPercentage`,`els`.`NoOfPayPeriod` AS `NoOfPayPeriod`,`els`.`LoanPayPeriodLeft` AS `LoanPayPeriodLeft`,`els`.`Comments` AS `Comments`,`els`.`Nondeductible` AS `Nondeductible`,`els`.`ReferenceLoanID` AS `ReferenceLoanID`,`els`.`SubstituteEndDate` AS `SubstituteEndDate`,`els`.`PayStubID` AS `PayStubID`,`pp`.`RowID` AS `PayPeriodID`,`pp`.`Year` AS `Year`,`pp`.`Month` AS `Month`,`pp`.`OrdinalValue` AS `OrdinalValue`,`pp`.`PayFromDate` AS `PayFromDate`,`pp`.`PayToDate` AS `PayToDate`,`ps`.`RowID` AS `PayStubRowId` from (((((`employeeloanschedule` `els` join `employee` `e` on(`e`.`RowID` = `els`.`EmployeeID` and find_in_set(`e`.`EmploymentStatus`,`UNEMPLOYEMENT_STATUSES`()) = 0)) join `dates` `d` on(`d`.`DateValue` between `els`.`DedEffectiveDateFrom` and `els`.`DedEffectiveDateTo`)) join `organization` `og` on(`og`.`RowID` = `els`.`OrganizationID` and `og`.`NoPurpose` = 0)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `d`.`DateValue` between `pp`.`PayFromDate` and `pp`.`PayToDate` and `pp`.`Half` = 1)) left join `paystub` `ps` on(`ps`.`EmployeeID` = `e`.`RowID` and `ps`.`OrganizationID` = `e`.`OrganizationID` and `ps`.`PayPeriodID` = `pp`.`RowID`)) where `els`.`DeductionSchedule` = 'First half' union select `els`.`RowID` AS `RowID`,`els`.`OrganizationID` AS `OrganizationID`,`els`.`Created` AS `Created`,`els`.`CreatedBy` AS `CreatedBy`,`els`.`LastUpd` AS `LastUpd`,`els`.`LastUpdBy` AS `LastUpdBy`,`els`.`EmployeeID` AS `EmployeeID`,`els`.`LoanNumber` AS `LoanNumber`,`els`.`DedEffectiveDateFrom` AS `DedEffectiveDateFrom`,`els`.`DedEffectiveDateTo` AS `DedEffectiveDateTo`,`els`.`TotalLoanAmount` AS `TotalLoanAmount`,`els`.`DeductionSchedule` AS `DeductionSchedule`,`els`.`TotalBalanceLeft` AS `TotalBalanceLeft`,`els`.`DeductionAmount` AS `DeductionAmount`,`els`.`Status` AS `Status`,`els`.`LoanTypeID` AS `LoanTypeID`,`els`.`DeductionPercentage` AS `DeductionPercentage`,`els`.`NoOfPayPeriod` AS `NoOfPayPeriod`,`els`.`LoanPayPeriodLeft` AS `LoanPayPeriodLeft`,`els`.`Comments` AS `Comments`,`els`.`Nondeductible` AS `Nondeductible`,`els`.`ReferenceLoanID` AS `ReferenceLoanID`,`els`.`SubstituteEndDate` AS `SubstituteEndDate`,`els`.`PayStubID` AS `PayStubID`,`pp`.`RowID` AS `PayPeriodID`,`pp`.`Year` AS `Year`,`pp`.`Month` AS `Month`,`pp`.`OrdinalValue` AS `OrdinalValue`,`pp`.`PayFromDate` AS `PayFromDate`,`pp`.`PayToDate` AS `PayToDate`,`ps`.`RowID` AS `PayStubRowId` from (((((`employeeloanschedule` `els` join `employee` `e` on(`e`.`RowID` = `els`.`EmployeeID` and find_in_set(`e`.`EmploymentStatus`,`UNEMPLOYEMENT_STATUSES`()) = 0)) join `dates` `d` on(`d`.`DateValue` between `els`.`DedEffectiveDateFrom` and `els`.`DedEffectiveDateTo`)) join `organization` `og` on(`og`.`RowID` = `els`.`OrganizationID` and `og`.`NoPurpose` = 0)) join `payperiod` `pp` on(`pp`.`OrganizationID` = `e`.`OrganizationID` and `pp`.`TotalGrossSalary` = `e`.`PayFrequencyID` and `d`.`DateValue` between `pp`.`PayFromDate` and `pp`.`PayToDate` and `pp`.`Half` in (0,1))) left join `paystub` `ps` on(`ps`.`EmployeeID` = `e`.`RowID` and `ps`.`OrganizationID` = `e`.`OrganizationID` and `ps`.`PayPeriodID` = `pp`.`RowID`)) where `els`.`DeductionSchedule` = 'Per pay period' ;

/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IF(@OLD_FOREIGN_KEY_CHECKS IS NULL, 1, @OLD_FOREIGN_KEY_CHECKS) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
