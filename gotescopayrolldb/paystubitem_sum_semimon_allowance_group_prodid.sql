/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!50503 SET NAMES utf8mb4 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

DROP VIEW IF EXISTS `paystubitem_sum_semimon_allowance_group_prodid`;
DROP TABLE IF EXISTS `paystubitem_sum_semimon_allowance_group_prodid`;
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `paystubitem_sum_semimon_allowance_group_prodid` AS select `et`.`RowID` AS `RowID`,`ea`.`ProductID` AS `ProductID`,`ea`.`EmployeeID` AS `EmployeeID`,`ea`.`OrganizationID` AS `OrganizationID`,`d`.`DateValue` AS `Date`,0 AS `Column1`,0 AS `Column2`,round(`ea`.`AllowanceAmount` / (`e`.`WorkDaysPerYear` / 12 / `PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`)),1) AS `TotalAllowanceAmt`,`ea`.`TaxableFlag` AS `TaxableFlag`,if(ifnull(`et`.`Absent`,0) > 0,ifnull(`sh`.`DivisorToDailyRate`,8),0) AS `HoursToLess`,`ea`.`AllowanceAmount` AS `AllowanceAmount`,`e`.`WorkDaysPerYear` AS `WorkDaysPerYear`,`p`.`Fixed` AS `Fixed`,`PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`) AS `PAYFREQDIV`,ifnull(`sh`.`DivisorToDailyRate`,8) AS `DivisorToDailyRate`,round(`ea`.`AllowanceAmount` / (`e`.`WorkDaysPerYear` / 12 / `PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`)),1) AS `DailyAllowance`,1 AS `Result` from (((((((((`employeeallowance` `ea` join `employee` `e` on(`e`.`OrganizationID` = `ea`.`OrganizationID` and `e`.`RowID` = `ea`.`EmployeeID` and find_in_set(`e`.`EmploymentStatus`,`UNEMPLOYEMENT_STATUSES`()) = 0)) join `product` `p` on(`p`.`RowID` = `ea`.`ProductID` and locate('ecola',lcase(`p`.`PartNo`)) > 0)) join `payfrequency` `pf` on(`pf`.`RowID` = `e`.`PayFrequencyID`)) join `dates` `d` on(`d`.`DateValue` between `ea`.`EffectiveStartDate` and `ea`.`EffectiveEndDate`)) left join `employeetimeentry` `et` on(`et`.`Date` = `d`.`DateValue` and `et`.`EmployeeID` = `e`.`RowID` and `et`.`OrganizationID` = `e`.`OrganizationID`)) left join `employeesalary` `esa` on(`esa`.`RowID` = `et`.`EmployeeSalaryID`)) left join `employeeshift` `es` on(`es`.`RowID` = `et`.`EmployeeShiftID`)) left join `shift` `sh` on(`sh`.`RowID` = `es`.`ShiftID`)) join `payrate` `pr` on(`pr`.`Date` = `d`.`DateValue` and `pr`.`OrganizationID` = `ea`.`OrganizationID`)) where `ea`.`AllowanceFrequency` = 'Semi-monthly' union select `et`.`RowID` AS `RowID`,`ea`.`ProductID` AS `ProductID`,`ea`.`EmployeeID` AS `EmployeeID`,`ea`.`OrganizationID` AS `OrganizationID`,`d`.`DateValue` AS `Date`,0 AS `Column1`,0 AS `Column2`,round(`ea`.`AllowanceAmount` / (`e`.`WorkDaysPerYear` / 12 / `PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`)),1) AS `TotalAllowanceAmt`,`ea`.`TaxableFlag` AS `TaxableFlag`,if(`pr`.`PayType` <> 'Regular Day' or ifnull(`et`.`Absent`,0) > 0,ifnull(`sh`.`DivisorToDailyRate`,8),0) AS `HoursToLess`,`ea`.`AllowanceAmount` AS `AllowanceAmount`,`e`.`WorkDaysPerYear` AS `WorkDaysPerYear`,`p`.`Fixed` AS `Fixed`,`PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`) AS `PAYFREQDIV`,ifnull(`sh`.`DivisorToDailyRate`,8) AS `DivisorToDailyRate`,round(`ea`.`AllowanceAmount` / (`e`.`WorkDaysPerYear` / 12 / `PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`)),1) AS `DailyAllowance`,2 AS `Result` from (((((((((`employeeallowance` `ea` join `employee` `e` on(`e`.`OrganizationID` = `ea`.`OrganizationID` and `e`.`RowID` = `ea`.`EmployeeID` and `e`.`EmploymentStatus` = 'Contractual')) join `product` `p` on(`p`.`RowID` = `ea`.`ProductID` and locate('ecola',lcase(`p`.`PartNo`)) > 0)) join `payfrequency` `pf` on(`pf`.`RowID` = `e`.`PayFrequencyID`)) join `dates` `d` on(`d`.`DateValue` between `ea`.`EffectiveStartDate` and `ea`.`EffectiveEndDate`)) left join `employeetimeentry` `et` on(`et`.`Date` = `d`.`DateValue` and `et`.`EmployeeID` = `e`.`RowID` and `et`.`OrganizationID` = `e`.`OrganizationID`)) left join `employeesalary` `esa` on(`esa`.`RowID` = `et`.`EmployeeSalaryID`)) left join `employeeshift` `es` on(`es`.`RowID` = `et`.`EmployeeShiftID`)) left join `shift` `sh` on(`sh`.`RowID` = `es`.`ShiftID`)) join `payrate` `pr` on(`pr`.`Date` = `d`.`DateValue` and `pr`.`OrganizationID` = `ea`.`OrganizationID`)) where `ea`.`AllowanceFrequency` = 'Semi-monthly' union select `et`.`RowID` AS `RowID`,`ea`.`ProductID` AS `ProductID`,`et`.`EmployeeID` AS `EmployeeID`,`et`.`OrganizationID` AS `OrganizationID`,`et`.`Date` AS `Date`,0 AS `Column1`,if(`e`.`EmployeeType` = 'Daily',`esa`.`BasicPay`,`esa`.`Salary` / (`e`.`WorkDaysPerYear` / 12)) AS `Column2`,if(`pr`.`PayType` = 'Regular Day',if(`et`.`TotalDayPay` > `et`.`RegularHoursAmount` and `et`.`VacationLeaveHours` + `et`.`SickLeaveHours` + `et`.`MaternityLeaveHours` + `et`.`OtherLeaveHours` > 0,if(`et`.`RegularHoursAmount` = 0,`et`.`TotalDayPay`,`et`.`RegularHoursAmount`),if(`et`.`RegularHoursAmount` > if(`e`.`EmployeeType` = 'Daily',`esa`.`BasicPay`,`esa`.`Salary` / (`e`.`WorkDaysPerYear` / 12)),if(`e`.`EmployeeType` = 'Daily',`esa`.`BasicPay`,`esa`.`Salary` / (`e`.`WorkDaysPerYear` / 12)),`et`.`RegularHoursAmount`)),if(`pr`.`PayType` = 'Special Non-Working Holiday' and `e`.`CalcSpecialHoliday` = '1',if(`e`.`EmployeeType` = 'Daily',`et`.`RegularHoursAmount` / `pr`.`PayRate`,`et`.`HolidayPayAmount`),if(`pr`.`PayType` = 'Special Non-Working Holiday' and `e`.`CalcSpecialHoliday` = '0',if(`e`.`EmployeeType` = 'Daily',`et`.`RegularHoursAmount`,`et`.`HolidayPayAmount`),if(`pr`.`PayType` = 'Regular Holiday' and `e`.`CalcHoliday` = '1',`et`.`HolidayPayAmount` + (`et`.`VacationLeaveHours` + `et`.`SickLeaveHours` + `et`.`MaternityLeaveHours` + `et`.`OtherLeaveHours`) * (if(`e`.`EmployeeType` = 'Daily',`esa`.`BasicPay`,`esa`.`Salary` / (`e`.`WorkDaysPerYear` / 12)) / ifnull(`COMPUTE_TimeDifference`(`sh`.`TimeFrom`,`sh`.`TimeTo`) - `COMPUTE_TimeDifference`(`sh`.`BreakTimeFrom`,`sh`.`BreakTimeTo`),0)),0)))) / if(`e`.`EmployeeType` = 'Daily',`esa`.`BasicPay`,`esa`.`Salary` / (`e`.`WorkDaysPerYear` / 12)) * (`ea`.`AllowanceAmount` / (`e`.`WorkDaysPerYear` / (`PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`) * 12))) AS `TotalAllowanceAmt`,`ea`.`TaxableFlag` AS `TaxableFlag`,`et`.`HoursLate` + `et`.`UndertimeHours` + if(ifnull(`et`.`Absent`,0) > 0,ifnull(`sh`.`DivisorToDailyRate`,8),0) AS `HoursToLess`,`ea`.`AllowanceAmount` AS `AllowanceAmount`,`e`.`WorkDaysPerYear` AS `WorkDaysPerYear`,`p`.`Fixed` AS `Fixed`,`PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`) AS `PAYFREQDIV`,ifnull(`sh`.`DivisorToDailyRate`,8) AS `DivisorToDailyRate`,`ea`.`AllowanceAmount` / (`e`.`WorkDaysPerYear` / 12 / `PAYFREQUENCY_DIVISOR`(`pf`.`PayFrequencyType`)) AS `DailyAllowance`,3 AS `Result` from ((((((((`employeetimeentry` `et` join `employee` `e` on(`e`.`OrganizationID` = `et`.`OrganizationID` and `e`.`RowID` = `et`.`EmployeeID` and find_in_set(`e`.`EmploymentStatus`,`UNEMPLOYEMENT_STATUSES`()) = 0)) join `employeesalary` `esa` on(`esa`.`RowID` = `et`.`EmployeeSalaryID`)) join `payfrequency` `pf` on(`pf`.`RowID` = `e`.`PayFrequencyID`)) left join `employeeshift` `es` on(`es`.`RowID` = `et`.`EmployeeShiftID`)) left join `shift` `sh` on(`sh`.`RowID` = `es`.`ShiftID`)) join `employeeallowance` `ea` on(`ea`.`AllowanceFrequency` = 'Semi-monthly' and `ea`.`EmployeeID` = `e`.`RowID` and `ea`.`OrganizationID` = `e`.`OrganizationID` and `et`.`Date` between `ea`.`EffectiveStartDate` and `ea`.`EffectiveEndDate`)) join `product` `p` on(`p`.`RowID` = `ea`.`ProductID` and locate('ecola',lcase(`p`.`PartNo`)) = 0)) join `payrate` `pr` on(`pr`.`RowID` = `et`.`PayRateID`)) ;

/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IF(@OLD_FOREIGN_KEY_CHECKS IS NULL, 1, @OLD_FOREIGN_KEY_CHECKS) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
